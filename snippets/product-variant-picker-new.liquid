{% comment %}
  Renders product variant-picker

  Accepts:
  - product: {Object} product object.
  - block: {Object} passing the block information.
  - product_form_id: {String} Id of the product form to which the variant picker is associated.
  - update_url: {Boolean} whether or not to update url when changing variants. If false, the url isn't updated. Default: true (optional).
  Usage:
  {% render 'product-variant-picker', product: product, block: block, product_form_id: product_form_id %}
{% endcomment %}
{% style %}
  .variant-value-new {
    width: 35px;
    height: 35px;
    font-size: 14px;
  }

  .variant-value {
    cursor: pointer;
    border: 2px solid transparent; /* Default state with transparent border */
    padding: 5px; /* Padding for better visual appearance */
    margin: 2px; /* Space between variant options */
  }

  .variant-value.selected {
    border-color: #333; /* Border color when selected */
  }

  .variant-value.variant-unavailable {
    opacity: 0.5;
    cursor: not-allowed;
  }
{% endstyle %}
{%- unless product.has_only_default_variant -%}
  {%- if block.settings.picker_type == 'button' -%}
    <variant-radios
      id="variant-radios-{{ section.id }}"
      class="no-js-hidden"
      data-section="{{ section.id }}"
      data-url="{{ product.url }}"
      {% if update_url == false %}
        data-update-url="false"
      {% endif %}
      {{ block.shopify_attributes }}
    >
      {%- for option in product.options_with_values -%}
        <fieldset class="js product-form__input">
          <legend
            class="form__label"
            style="    font-family: Plus Jakarta Sans,sans-serif!important; color: black; font-size: 19px;"
          >
            {{ option.name }}
          </legend>
          {% render 'product-variant-options-new', product: product, option: option, block: block %}
        </fieldset>
      {%- endfor -%}
      <script type="application/json">
        {{ product.variants | json }}
      </script>
    </variant-radios>

  {%- else -%}
    {{ 'variant-map.js' | asset_url | script_tag }}

    <form
      action="/cart/add"
      method="post"
      enctype="multipart/form-data"
      id="{{ product_form_id }}"
      novalidate="novalidate"
    >
      {% for option in product.options_with_values %}
        <div class="variant-option">
          <h3>{{ option.name }}</h3>
          <div class="variant-values">
            {% for value in option.values %}
              {% assign variant_found = false %}
              {% for variant in product.variants %}
                {% if variant.options contains value and variant.available %}
                  <div
                    class="variant-value variant-value-new"
                    data-value="{{ value }}"
                    data-option="{{ option.name }}"
                    data-variant-id="{{ variant.id }}"
                    data-variant-price="{{ variant.price | money }}"
                    data-variant-image="{{ variant.featured_image | default: product.featured_image | img_url: 'master' }}"
                    onclick="updateVariantSelection(this)"
                  >
                    <!-- Placeholder for the value, filled by JavaScript -->
                  </div>
                  {% assign variant_found = true %}
                  {% break %}
                {% endif %}
              {% endfor %}
              {% unless variant_found %}
                <div
                  class="variant-value variant-value-new variant-unavailable"
                  data-value="{{ value }}"
                  data-option="{{ option.name }}"
                >
                  <!-- Placeholder for the value, filled by JavaScript -->
                </div>
              {% endunless %}
            {% endfor %}
          </div>
        </div>
      {% endfor %}

      <!-- Hidden input to store selected variant ID -->
      <input type="hidden" name="id" class="product-variant-id">

      <!-- Add to Cart Button -->
      <button
        type="submit"
        name="add"
        style="
          min-height: 30px; font-size: 14px; background-color: black !important;
          color: white !important;
          height: 30px !important;
          text-transform: uppercase;
          font-family: Plus Jakarta Sans, sans-serif !important;
        "
        class="overboard-buy-button button button--full-width button--secondary product-form__cart-submit"
        {% unless product.available %}
          disabled
        {% endunless %}
      >
        <span>{{ 'products.product.add_to_cart' | t }}</span>
      </button>
    </form>

    <script>
      function updateVariantSelection(element) {
        var variantId = element.getAttribute('data-variant-id');
        var variantPrice = element.getAttribute('data-variant-price');
        var variantImageSrc = element.getAttribute('data-variant-image');

        // Update hidden input for variant ID
        document.querySelector('.product-variant-id').value = variantId;

        // Update the price display if necessary
        if (document.querySelector('.price-item')) {
          document.querySelector('.price-item').textContent = variantPrice;
        }

        // Optionally update product image
        if (document.querySelector('.product__media img')) {
          document.querySelector('.product__media img').src = variantImageSrc;
        }

        // Enable the Add to Cart button if the variant is available
        document.querySelector('.product-form__cart-submit').disabled = false;
      }

      document.addEventListener('DOMContentLoaded', function () {
        // Automatically select the first available variant
        const firstAvailableVariant = document.querySelector('.variant-value:not(.variant-unavailable)');
        if (firstAvailableVariant) {
          firstAvailableVariant.click();
        }
      });
    </script>

    <script>
      document.addEventListener('DOMContentLoaded', function () {
        var variantOptions = document.querySelectorAll('.variant-value');
        var productImage = document.querySelector('.product__media img');
        var productPrice = document.querySelector('.price-item');
        var variantInput = document.querySelector('.product-variant-id');

        variantOptions.forEach((option) => {
          var value = option.getAttribute('data-value');
          var optionType = option.getAttribute('data-option');
          var variantId = option.getAttribute('data-variant-id');
          var variantPrice = option.getAttribute('data-variant-price');
          var variantImageSrc = option.getAttribute('data-variant-image');

          // Set up the variant map
          if (variantMap.colors[value]) {
            option.style.backgroundColor = variantMap.colors[value];
          } else if (variantMap.sizes[value]) {
            option.textContent = variantMap.sizes[value];
            option.classList.add('text-type');
          } else {
            option.textContent = value;
            option.classList.add('text-type');
          }

          // Handle unavailable variants
          if (!variantId) {
            option.classList.add('variant-unavailable');
            option.style.pointerEvents = 'none';
            option.style.opacity = '0.5';
          } else {
            option.addEventListener('click', function () {
              // Update selected variant
              variantOptions.forEach((opt) => opt.classList.remove('selected'));
              option.classList.add('selected');

              if (variantInput) {
                variantInput.value = variantId;
              }

              // Update Shopify's variant selector
              var variantSelect = document.querySelector('select[name=id]');
              if (variantSelect) {
                variantSelect.value = variantId;
              }

              // Update the price
              if (productPrice && variantPrice) {
                productPrice.textContent = variantPrice;
              }
            });
          }
        });

        // Automatically select the first available variant
        const firstAvailableVariant = document.querySelector('.variant-value:not(.variant-unavailable)');
        if (firstAvailableVariant) {
          firstAvailableVariant.click();
        }
      });
    </script>
  {%- endif -%}
{%- endunless -%}
